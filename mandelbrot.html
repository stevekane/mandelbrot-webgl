<!DOCTYPE html>
<head>
  <title>Mandelbrot WebGL</title>
  <link rel="stylesheet" type="text/css" href="/styles.css" />
</head>
<body>
  <div class="floating" id="stats">
    <h1 id="name"></h1>
    <ul>
      <li id="x-coord"></li> 
      <li id="y-coord"></li> 
      <li id="rotation"></li> 
      <li id="scale"></li> 
    </ul>
  </div>

  <script type="x-shader" id="vShader">
    precision highp float;

    attribute vec2 a_position;

    void main () {
      gl_Position = vec4(a_position, 0, 1); 
    } 
  </script>

  <script type="x-shader" id="fShader">
    precision highp float;

    uniform sampler2D u_image;
    uniform vec2 screenSize;
    uniform mat3 zoomScale;
    uniform mat3 rotation;
    uniform mat3 center;

    void main () {
      float xyRatio = screenSize.x / screenSize.y;

      mat3 fragScale = mat3(
        1.0 / screenSize.y , 0                 , 0,
        0                  , 1.0 / screenSize.y, 0,
        0                  , 0                 , 1.0
      );
      mat3 clipTranslation = mat3(
        1             ,    0, 0,
        0             ,    1, 0,
        -0.5 * xyRatio, -0.5, 1
      );
      vec3 c =
        center * 
        zoomScale * 
        rotation *
        clipTranslation * 
        fragScale * 
        vec3(gl_FragCoord.xy, 1);
      vec3 z;

      int j = 0;
      z = c;
      for ( int i = 0; i < 100; i++ ) {
        float x = (z.x * z.x - z.y * z.y) + c.x;
        float y = (z.y * z.x + z.x * z.y) + c.y;

        j = i;
        if ((x * x + y * y) > 4.0) break;
        z.x = x;
        z.y = y;
      }

      float mult = j == 100 ? 0.0 : (float(j) / 100.0);

      gl_FragColor = texture2D(u_image, vec2(mult, 1.0));
    }
  </script>

  <canvas id="view"></canvas>
  <script type="text/javascript" src="/utils.js"></script>
  <script type="text/javascript" src="/gl-utils.js"></script>
  <script type="text/javascript" src="/timeline.js"></script>
  <script type="text/javascript" src="/mandelbrot.js"></script>
</body>
